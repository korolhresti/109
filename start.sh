#!/bin/bash

# Цей скрипт виконується при кожному запуску/перезапуску сервісу на Render

echo "Застосування схеми до бази даних..."
# Вихід при першій помилці
set -e 

# Застосовуємо схему. Прапорець -X запобігає виводу зайвих повідомлень.
# Команда виконається успішно, навіть якщо таблиці вже існують, завдяки "IF NOT EXISTS" у вашому .sql файлі.
# Це також додасть відсутні стовпці до існуючих таблиць.
psql $DATABASE_URL -f schema.sql -X

echo "Схема бази даних успішно застосована."

# Оскільки всі файли знаходяться в кореневій директорії,
# немає потреби змінювати директорію або додавати її до PYTHONPATH.
# Uvicorn більше не використовується для цього спрощеного бота.

echo "Запуск воркера бота..."
# Запускаємо воркер бота
python bot.py worker
