#!/bin/bash

# Цей скрипт виконується при кожному запуску/перезапуску сервісу на Render

echo "Застосування схеми до бази даних..."
# Вихід при першій помилці
set -e 

# Застосовуємо схему. Прапорець -X запобігає виводу зайвих повідомлень.
# Команда виконається успішно, навіть якщо таблиці вже існують, завдяки "IF NOT EXISTS" у вашому .sql файлі.
# Це також додасть відсутні стовпці до існуючих таблиць.
psql $DATABASE_URL -f schema.sql -X

echo "Схема бази даних успішно застосована."

# Оскільки всі файли знаходяться в кореневій директорії,
# немає потреби змінювати директорію або додавати її до PYTHONPATH.
# Uvicorn автоматично знайде bot.py в поточній директорії.

echo "Запуск веб-сервера Uvicorn..."
# Запускаємо веб-сервер на порту, який надає Render (зазвичай 10000)
# Uvicorn буде шукати 'app' всередині 'bot.py' в поточній директорії
uvicorn bot:app --host 0.0.0.0 --port ${PORT:-10000}
